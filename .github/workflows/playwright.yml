name: Quality Gate
on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install JS Deps
        run: npm install && npx playwright install --with-deps

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Python Deps
        run: pip install pytest requests

      - name: Run Intent-Based Tests
        run: |
          MSG=$(git log -1 --pretty=%B)
          if [[ "$MSG" == *"#full"* ]]; then
            npm run test:full
          elif [[ "$MSG" == *"#api"* ]]; then
            pytest tests_python/
          else
            npx playwright test --grep @smoke
          fi